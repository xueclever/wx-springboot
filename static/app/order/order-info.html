<div class="row">
    <div class="top-handle-btn">
        <form id="search-form" action="javascript:;">
            每页显示：<input name="pageSize" class="form-control  input-small inline" type="number" min="2" max="50" style="width: 80px;"  value="10" />
            <div style="display: inline-block;position: relative;top: 11px;">
			        <div class="input-group date  form_datetime " style="float: left">
			            <span style="margin:8px"></span>
			            <input type="text" size="16" name="startDate" id="startDateFrm" readonly class="form-control input-small inline" />
			            <span class="input-group-btn">
			                                        <button class="btn default date-set" type="button">
			                                            <i class="fa fa-calendar"></i>
			                                        </button>
			                                        </span>
			        </div>
			        <div class="input-group date  form_datetime " style="float: left">
			            <input type="text" size="16" name="endDate" id="endDateFrm" readonly class="form-control input-small inline" />
			            <span class="input-group-btn">
			                                        <button class="btn default date-set" type="button">
			                                            <i class="fa fa-calendar"></i>
			                                        </button>
			                                        </span>
			        </div>
	    </div>
            
            <input type="text" class="form-control input-small inline" name="orderNo" placeholder="输入运单编号" />
            <button class="btn purple right search radius6"><i class="fa fa-search"></i> 查询</button>
            <!-- <a class='btn green radius6' data-toggle='modal' href='#modal-add'><i class="fa fa-plus"></i> 添加</a> -->
        </form>
    </div>
</div>


<div id="modals">
    <div class="modal fade" id="modal-add" role="basic" aria-hidden="true">
        <div class="modal-dialog" style="width: 500px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">新增</h4>
                </div>
                <div class="modal-body">
                    <form action="javascript:;" method="post">
                        <table class="table table-striped table-bordered ">
                            <tr>
                                <th>用户名</th>
                                <td colspan="3">
                                    <input class=" input-medium form-control inline " type="text" name="username" maxlength="16" value="">
                                    <span class="required-star">* </span>
                                </td>
                            </tr>
                            <tr>
                                <th>用户昵称</th>
                                <td colspan="3">
                                    <input class=" input-medium form-control inline " type="text" name="nickname" maxlength="16" value="">
                                    <span class="required-star">* </span>
                                </td>
                            </tr>
                            <tr>
                                <th width="100">账号角色：</th>
                                <td colspan="3">
                                    <select class=" input-medium form-control inline " name="roleId">
                                    </select>
                                    <input type="hidden" name="roleName" data-ref="roleId" value="" />
                                </td>
                            </tr>
                            <tr>
                                <th>密码设置</th>
                                <td colspan="3">
                                    <input class=" input-medium form-control inline " type="pwd" name="pwd" maxlength="16" value="">
                                    <span class="required-star">* </span>
                                </td>
                            </tr>
                            <tr>
                                <th>联系电话</th>
                                <td colspan="3">
                                    <input class=" input-medium form-control inline " type="text" name="tel" value="">
                                </td>
                            </tr>
                            <tr>
                                <th>管理权限</th>
                                <td colspan="3">
                                    <input type="checkbox" name="isEnabled" data-size='small' value="1" />
                                    <!--<label> <input type="radio" name="showStatus" value="false"/>开启 </label>-->
                                    <!--<label><input type="radio" name="showStatus" value="true"/> 停用 </label>-->
                                    <!--<input type="hidden" name="isBan" data-ref="showStatus" value=""/>-->
                                </td>
                            </tr>
                            <tr>
                                <th>数据权限：</th>
                                <td colspan="3">
                                    <input type="checkbox" name="enableDataRole" data-size='small' value="1" />
                                    <!--<label><input type="radio" value="1" name="showEnableDataRole"/>开启</label>-->
                                    <!--<label><input type="radio" value="0" checked name="showEnableDataRole"/>默认</label>-->
                                    <!--<input type="hidden" name="enableDataRole" data-ref="showEnableDataRole" value="0"/>-->
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn dark green btn-save radius6"><i class="fa fa-save"></i> 添加</button>
                    <button type="button" class="btn dark btn-outline radius6" data-dismiss="modal"><i class="fa fa-close"></i> 关闭</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="modal-edit" role="basic" aria-hidden="true">
        <div class="modal-dialog" style="width: 500px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                </div>
                <div class="modal-body">
                    <form action="javascript:;" method="post">
                        <input type="hidden" name="id" value="" />
                        <table class="table table-striped table-bordered ">
                            <tr>
                                <td><span  style="font-size:10px;">运单编号</span></td>
                                <td colspan="1">
                                    <span  style="font-size:10px;" id="orderno">20180228071946WQ4329</span>
                                </td>
                            </tr>
                            <tr>
                                <th><span style="font-size:10px;" >创建人</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="memberName">张三</span>
                                </td>
                                <th> <span style="font-size:10px;">创建时间</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="createtime">2018-10-21</span>
                                </td>
                            </tr>
                            
                             <tr>
                                <th colspan="2"><span style="font-size:10px;">收件方</span></th>
                                <th colspan="2"> <span style="font-size:10px;">发件方</span></th>
                            </tr>
                            
                             <tr>
                                <th><span style="font-size:10px;">收件人</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="recPerson">张三</span>
                                </td>
                                <th> <span style="font-size:10px;">发件人</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="mailPerson">李四</span>
                                </td>
                            </tr>
                            
                            <tr>
                                <th><span style="font-size:10px;">联系电话</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="recTel">15173139267</span>
                                </td>
                                <th> <span style="font-size:10px;">联系电话</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="mailTel">15173139267</span>
                                </td>
                            </tr>
                            
                             <tr>
                                <th><span style="font-size:10px;">单位</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="recUnitName">上海美萌</span>
                                </td>
                                <th> <span style="font-size:10px;">单位</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="mailUnitName">上海美萌</span>
                                </td>
                            </tr>
                            
                            <tr>
                                <th><span style="font-size:10px;">收货地址</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="recDetailAdress">上海宝山区逸仙路8888弄100号505室</span>
                                </td>
                                <th> <span style="font-size:10px;">收货地址</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="mailDetailAdress">上海宝山区逸仙路8888弄100号505室</span>
                                </td>
                            </tr>
                            
                            <tr>
                                <th><span style="font-size:10px;">交易方式</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="recMode">直送</span>
                                </td>
                                <th> <span style="font-size:10px;">回单份数</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="receipt">2</span>
                                </td>
                            </tr>
                            
                             <tr>
                                <th><span style="font-size:10px;"></span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;"></span>
                                </td>
                                <th> <span style="font-size:10px;">发货日期</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="mailtime">2017-10-23</span>
                                </td>
                            </tr>
                            
                            <tr>
                                <th><span style="font-size:10px;"></span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;"></span>
                                </td>
                                <th> <span style="font-size:10px;">预计到达时间</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="arrivetime">2017-10-23</span>
                                </td>
                            </tr>
                            
                        </table>
                        ----------------------------------------------------------------------------------------------------
                        货物信息
                        <table class="table table-striped table-bordered " id="hwtable">
                        	
                        </table>
                        ----------------------------------------------------------------------------------------------------
                        <table class="table table-striped table-bordered ">
                        	 <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">运费合计</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="totalFreight">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">投保额度</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="coverage">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">保险费</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="premium">￥3,000.00</span>
                                </td>
                             </tr>
                        </table>
                        
                        ----------------------------------------------------------------------------------------------------
                        
                        <table class="table table-striped table-bordered ">
                        	 <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">付款总额</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="totalPayments">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">预付款</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="prepayment">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">预付款-现金</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="prepaymentCash">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">预付款-油卡</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="prepaymentOilCard">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">回单付</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="totalReceipt">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">回单付-现金</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="receiptCash">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">回单付-油卡</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="receiptOilCard">￥3,000.00</span>
                                </td>
                             </tr>
                              <tr>
                            	<td colspan="1">
                                    <span style="font-size:10px;">到付</span>
                                </td>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="fadPayment">￥3,000.00</span>
                                </td>
                             </tr>
                        </table>
                        ----------------------------------------------------------------------------------------------------
                                                                                   货物信息
                        <table class="table table-striped table-bordered ">
                        	  <tr>
                                <th><span style="font-size:10px;">司机姓名</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="driverName">张萌</span>
                                </td>
                                <th> <span style="font-size:10px;">联系电话</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="driverTel">15173139267</span>
                                </td>
                            </tr>
                            <tr>
                                <th><span style="font-size:10px;">身份证号码</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="driverCard">46562223256464656</span>
                                </td>
                                <th> <span style="font-size:10px;">车牌</span></th>
                                <td colspan="3">
                                	<span style="font-size:10px;" id="plateNumber">车牌号</span>
                                </td>
                            </tr>
                            <tr>
                                <th><span style="font-size:10px;">承运单位</span></th>
                                <td colspan="1">
                                    <span style="font-size:10px;" id="carriageCompany">上海微盟软件科技有限公司</span>
                                </td>
                            </tr>
                        </table>     
                                                                              
                    </form>
                </div>
                <div class="modal-footer">
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="modal-img-view" tabindex="-1" role="basic" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">预览</h4>
                </div>
                <div class="modal-body" style="text-align: center">
                    <img src="" alt="" width="220px;" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>


    <!-- 重置密码 -->
    <div class="modal fade" id="modal-reset-pwd" tabindex="-1" role="basic" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px">
            <div class="modal-content">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span
                            class="sr-only">Close</span></button>
                    <h4 class="modal-title">密码重置</h4>
                </div>
                <form id="pwdForm" action="javascript:;">
                    <div class="modal-body">
                        <input type="hidden" id="userId-pwd" name="id" value="" />
                        <table class="table table-striped table-bordered table-hover">
                            <tbody>
                                <tr>
                                    <th width="100">密码：</th>
                                    <td><input class="input-medium form-control inline " type="password" id="pwd" name="pwd"
                                            value=""></td>
                                </tr>
                                <tr>
                                    <th width="100">确认密码：</th>
                                    <td><input class=" input-medium form-control inline " type="password" id="confirmPwd" value=""></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn dark green btn-save radius6"><i class="fa fa-check"></i> 保存</button>
                        <button type="button" class="btn dark btn-outline radius6" data-dismiss="modal"><i class="fa fa-remove"></i> 关闭</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<div class="row">
    <table id="data-table" class="table table-striped table-bordered table-hover" width="100%">
        <thead>
            <tr>
                <th>时间</th>
                <th>运单编号</th>
                <th>创建人</th>
                <th>收件人</th>
                <th>收件单位</th>
                <th>收件地址</th>
                <th>运费￥</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
        </tfoot>
    </table>
</div>
<script type="text/javascript">
    var resource = "/orderm/infobase";
    $(function () {
    
    //日期初始化
		$(".form_datetime").datepicker({
	        format: "yyyy-mm-dd",
	        language: 'zh-CN',
	        autoclose: 1,
	        todayBtn: 1
   		 });
   		 
   	var date = new Date();
    date = Shinez.FormateDate(date, "yyyy-MM-dd");
    $("input[name=startDate]").val(date);
    $("input[name=endDate]").val(date);
    $('.form_datetime').datepicker('update');

        DataTable.init({
            url: resource, //ajax请求url
            tableName: "data-table", //数据表table id
            paramsFormName: "search-form", //查询参数form id
            modal: "modals", //模态框div
            columns: [ //列对应的字段数组，注意顺序
                {
                    data: "createTime",
                    type: "datetime"
                },
                {
                    data: "orderno",
                },
                {
                    data: "memberName"
                },
                {
                    data: "recPerson"
                },
                {
                    data: "recUnitName",
                },
                {
                    data: "detailAddress"
                },
                {
                    data: "totalFreight",
                },
            ],
            options: [ //操作区域(id)
                {
                    icon: "fa fa-dedent",
                    option: "modal-edit",
                    edit: true,
                    editMain: true,
                    //                    visible: false,
                    url: resource,
                    pre: "checkDataRole"
                }
            ],
            handles: {
                insert: [{
                    url: resource,
                    modalId: "modal-add"
                }, ],
            },
            endFnOnce: "loadSelect",
            endFn: "registerSwitch"
        });




        //新增时
        $("#modal-add").on('show.bs.modal', function () {
            $("*[name=enableDataRole]").bootstrapSwitch("state", false);
        });

        //数据权限开关事件
        $("*[name=enableDataRole]").on("switchChange.bootstrapSwitch", function (e, state) {
            if (state) {
                $(".tr-role-config").css("display", "");
            } else {
                $(".tr-role-config").css("display", "none");
                $(".tr-role-config").find("select").val("").change();
            }
        });

    });

    //重置密码
    function doResetUserPwd() {
        if ($("#pwd").val() == "" || $("#confirmPwd").val() == "") {
            Shinez.tip("warning", "请输入密码");
            return false;
        }
        if ($("#pwd").val() != $("#confirmPwd").val()) {
            Shinez.tip("warning", "两次密码输入不一致");
            return false;
        }
        return true;
    }

    function loadSelect(data) {
       /** var roles = data.roles;
        roles.forEach(function (v, k) {
            $("select[name=roleId]").append("<option value='" + v.id + "'>" + v.roleName + "</option>");
        });

        var mps = data.mps;
        if (mps != null) {
            mps.forEach(function (v, k) {
                $("select[name=mpid]").append("<option value='" + v.id + "'>" + v.nickName + "</option>");
            });
        }


        var dataRoles = data.dataRoles;
        var columnVal;
        if (dataRoles != null) {
            dataRoles.forEach(function (v, k) {
               
                if (v.dataSelects == null) {
                    columnVal = "<input name='dataRoles[" + k + "].columnValue' value=''/>";
                } else {
                    columnVal = "<select class=' input-medium form-control inline '  name='dataRoles[" + k +
                        "].columnValue'><option value=''>不选择</option>";
                    v.dataSelects.forEach(function (a, b) {
                        columnVal += "<option value='" + a.id + "'>" + a[Object.getOwnPropertyNames(a)[
                            1]] + "</option>";
                    });
                    columnVal += "</select>";
                }
                $("#modal-add,#modal-edit").find("table").append("<tr data-code='" + v.dataRoleCode +
                    "' class='tr-role-config' style='display: none'>" +
                    "<td><input type='hidden' name='dataRoles[" + k + "].dataRoleCode' value='" + v.dataRoleCode +
                    "'>" + v.roleName + "</td>" +
                    //                "<td>"+v.tableName+"</td>" +
                    //                "<td>"+v.columnName+"</td>" +
                    "<td>" + columnVal + "</td></tr>");
            });
        }

        $("select").select2();*/
    }

	 function checkDataRole(obj) {
	 
	 	Shinez.get("/orderm/detailbase",{"id":obj},function (ret) {
            if(ret.code==0){
            	console.log(ret);
            	var c = ret.data.orderm;
            	var hw = ret.data.cargoinformationLt;
            	
            	var htm = "<tr>\r\n" + 
				"                                <th><span style=\"font-size:10px;\">货物名称</span></th>\r\n" + 
				"                                <th> <span style=\"font-size:10px;\">数量</span></th>\r\n" + 
				"                                <th> <span style=\"font-size:10px;\">运费单价</span></th>\r\n" + 
				"                            </tr>";
				for(var i=0;i<hw.length;i++){
					htm +="<tr>\r\n" + 
					"                            	<td colspan=\"1\">\r\n" + 
					"                                    <span style=\"font-size:10px;\">"+hw[i].cargoName+"</span>\r\n" + 
					"                                </td>\r\n" + 
					"                                <td colspan=\"1\">\r\n" + 
					"                                    <span style=\"font-size:10px;\">"+hw[i].count+" 件</span>\r\n" + 
					"                                </td>\r\n" + 
					"                                <td colspan=\"1\">\r\n" + 
					"                                    <span style=\"font-size:10px;\">￥"+hw[i].freightUnit+"</span>\r\n" + 
					"                                </td>\r\n" + 
					"                            </tr>";
				}
				
				$("#hwtable").html(htm);
				
            	
            	$("#recPerson").html(c.recPerson);
            	$("#mailPerson").html(c.mailPerson);
            	$("#orderno").html(c.orderno);
            	$("#memberName").html(c.memberName);
            	$("#carriageCompany").html(c.carriageCompany);
            	$("#coolieHire").html("￥"+c.coolieHire);
            	$("#coverage").html("￥"+c.coverage);
            	$("#driverCard").html(c.driverCard);
            	$("#driverName").html(c.driverName);
            	$("#driverTel").html(c.driverTel);
            	$("#fadPayment").html("￥"+c.fadPayment);
				$("#mailDetailAdress").html(c.mailProvince + c.mailCity + c.mailArea +c.mailDetailAdress);
				$("#mailTel").html(c.mailTel);
				$("#mailUnitName").html(c.mailUnitName);
				$("#plateNumber").html(c.plateNumber);
				$("#premium").html("￥"+c.premium);
				$("#prepayment").html("￥"+c.prepayment);
				$("#prepaymentCash").html("￥"+c.prepaymentCash);
				$("#prepaymentOilCard").html("￥"+c.prepaymentOilCard);
				$("#recDetailAdress").html(c.recProvince + c.recCity + c.recArea +c.recDetailAdress);
				$("#recUnitName").html(c.recUnitName);
				$("#recTel").html(c.recTel);
				$("#receipt").html(c.receipt);
				$("#receiptCash").html("￥"+c.receiptCash);
				$("#receiptOilCard").html("￥"+c.receiptOilCard);
				$("#totalFreight").html("￥"+c.totalFreight);
				$("#totalPayments").html("￥"+c.totalPayments);
				$("#totalReceipt").html("￥"+c.totalReceipt);
				$("#arrivetime").html(formatDateTime(c.arriveTime));
				$("#createtime").html(formatDateTime(c.createTime));
				$("#mailtime").html(formatDateTime(c.mailTime));
				if(c.recMode == 1){
					recModeVal = "直送";
				}else{
					recModeVal = "自提";
				}
				$("#recMode").html(recModeVal);
            }else{
                Shinez.tip("error",ret.msg);
            }
        });
    }
    
    function formatDateTime(inputTime) {    
	    var date = new Date(inputTime);  
	    var y = date.getFullYear();    
	    var m = date.getMonth() + 1;    
	    m = m < 10 ? ('0' + m) : m;    
	    var d = date.getDate();    
	    d = d < 10 ? ('0' + d) : d;    
	    var h = date.getHours();  
	    h = h < 10 ? ('0' + h) : h;  
	    var minute = date.getMinutes();  
	    var second = date.getSeconds();  
	    minute = minute < 10 ? ('0' + minute) : minute;    
	    second = second < 10 ? ('0' + second) : second;   
	    return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;    
	};  
	

    function registerSwitch() {
        $('.ban-status-sw').on('switchChange.bootstrapSwitch', function (e, state) {
            var $this = $(this);
            $this.bootstrapSwitch('state', !state, true);
            $(this).parents("tr").trigger("dblclick");
        });

    }
</script>